openapi: 3.0.1
info:
  title: EduTrack API
  version: 1.0.0
  description: EduTrack 백엔드(Spring Boot 3, Java 17)용 OpenAPI 스펙

servers:
  - url: http://localhost:8080
    description: Local

tags:
  - name: Users
  - name: Principal
  - name: Lectures
  - name: Assignments
  - name: Assignment Submissions
  - name: Exams
  - name: Student Dashboard

paths:
  ########################
  # UserController (/api/users)
  ########################
  /api/users/signin:
    post:
      tags: [Users]
      summary: 사용자 로그인
      operationId: signIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignInResponse'

  /api/users/logout:
    post:
      tags: [Users]
      summary: 사용자 로그아웃
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '204':
          description: 로그아웃 성공 (내용 없음)

  /api/users/me:
    get:
      tags: [Users]
      summary: 내 정보 조회
      operationId: getMyInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 내 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MyInfoResponse'

  ########################
  # PrincipalController (/api/academy/signup)
  ########################
  /api/academy/signup:
    post:
      tags: [Principal]
      summary: 원장(학원) 회원가입
      operationId: principalSignup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrincipalRegistrationRequest'
      responses:
        '201':
          description: 학원/원장 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrincipalRegistrationResponse'

  ########################
  # LectureController (/api/lectures)
  ########################
  /api/lectures:
    post:
      tags: [Lectures]
      summary: 강의 생성
      operationId: createLecture
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LectureCreationRequest'
      responses:
        '201':
          description: 강의 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LectureCreationResponse'

    get:
      tags: [Lectures]
      summary: 강의 목록 조회 (선생/원장)
      operationId: getLecturesByTeacher
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 강의 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LectureForTeacherResponse'

  /api/lectures/{lectureId}:
    get:
      tags: [Lectures]
      summary: 강의 상세 조회 (선생/원장)
      operationId: getLectureDetailForTeacher
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 강의 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LectureDetailForTeacherResponse'

  /api/lectures/{lectureId}/students:
    get:
      tags: [Lectures]
      summary: 강의를 듣는 학생 목록 조회
      operationId: getStudentsByLecture
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 학생 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudentSearchResponse'

    post:
      tags: [Lectures]
      summary: 강의에 학생 배정
      operationId: assignStudentsToLecture
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LectureStudentAssignRequest'
      responses:
        '200':
          description: 강의에 학생 배정 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LectureStudentAssignResponse'

  /api/lectures/{lectureId}/available-students:
    get:
      tags: [Lectures]
      summary: 강의에 배정되지 않은 학생 검색
      operationId: getAvailableStudentsForLecture
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: name
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 배정 가능 학생 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudentSearchResponse'

  ########################
  # AssignmentController (/api/academies/{academyId}/assignments)
  ########################
  /api/academies/{academyId}/assignments:
    post:
      tags: [Assignments]
      summary: 과제 생성
      operationId: createAssignment
      security:
        - BearerAuth: []
      parameters:
        - name: academyId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignmentCreateRequest'
      responses:
        '201':
          description: 과제 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentCreateResponse'

  ########################
  # AssignmentSubmissionController (/api/assignments)
  ########################
  /api/assignments/{assignmentId}/presigned-url:
    post:
      tags: [Assignment Submissions]
      summary: 과제 제출용 Presigned URL 발급
      operationId: getAssignmentPresignedUrl
      security:
        - BearerAuth: []
      parameters:
        - name: assignmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PresignedUrlRequest'
      responses:
        '200':
          description: Presigned URL 응답
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PresignedUrlResponse'

  /api/assignments/{assignmentId}/submit:
    post:
      tags: [Assignment Submissions]
      summary: 과제 제출
      operationId: submitAssignment
      security:
        - BearerAuth: []
      parameters:
        - name: assignmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: studentId
          in: query
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignmentSubmitRequest'
      responses:
        '200':
          description: 과제 제출 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentSubmitResponse'

  ########################
  # ExamController (/api/lectures/{lectureId}/exams)
  ########################
  /api/lectures/{lectureId}/exams:
    post:
      tags: [Exams]
      summary: 시험 생성
      operationId: createExam
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExamCreationRequest'
      responses:
        '201':
          description: 시험 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExamCreationResponse'

  /api/lectures/{lectureId}/exams/{examId}/mcq:
    post:
      tags: [Exams]
      summary: 시험 문제 등록
      operationId: registerExamQuestions
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: examId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/QuestionRegistrationRequest'
      responses:
        '200':
          description: 등록된 문제 ID 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QuestionIdResponse'

  /api/lectures/{lectureId}/exams/{examId}:
    get:
      tags: [Exams]
      summary: 시험 상세 조회
      operationId: getExamDetail
      security:
        - BearerAuth: []
      parameters:
        - name: lectureId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: examId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 시험 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExamDetailResponse'

  ########################
  # StudentDashboardController (/api/students)
  ########################
  /api/students/{studentId}/lectures:
    get:
      tags: [Student Dashboard]
      summary: 내 강의 목록 조회
      operationId: getMyLectures
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 내 강의 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MyLectureResponse'

  /api/students/{studentId}/attendance/check-in:
    post:
      tags: [Student Dashboard]
      summary: 출석 체크
      operationId: checkIn
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 출석 체크 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttendanceCheckInResponse'

  /api/students/{studentId}/assignments:
    get:
      tags: [Student Dashboard]
      summary: 내 과제 목록
      operationId: getMyAssignments
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 내 과제 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AssignmentSummaryResponse'

  /api/students/{studentId}/exams:
    get:
      tags: [Student Dashboard]
      summary: 내 시험 목록
      operationId: getMyExams
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 내 시험 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExamSummaryResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ########################
    # Users
    ########################
    SignInRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
      required: [email, password]

    SignInResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        userId:
          type: integer
          format: int64
        role:
          type: string

    MyInfoResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        email:
          type: string
        role:
          type: string

    ########################
    # Principal
    ########################
    PrincipalRegistrationRequest:
      type: object
      properties:
        academyName:
          type: string
        principalName:
          type: string
        email:
          type: string
        password:
          type: string
      required: [academyName, principalName, email, password]

    PrincipalRegistrationResponse:
      type: object
      properties:
        academyId:
          type: integer
          format: int64
        principalId:
          type: integer
          format: int64

    ########################
    # Lectures
    ########################
    LectureCreationRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
      required: [title]

    LectureCreationResponse:
      type: object
      properties:
        lectureId:
          type: integer
          format: int64

    LectureForTeacherResponse:
      type: object
      properties:
        lectureId:
          type: integer
          format: int64
        title:
          type: string

    LectureDetailForTeacherResponse:
      type: object
      properties:
        lectureId:
          type: integer
          format: int64
        title:
          type: string
        description:
          type: string

    StudentSearchResponse:
      type: object
      properties:
        studentId:
          type: integer
          format: int64
        name:
          type: string

    LectureStudentAssignRequest:
      type: object
      properties:
        studentIds:
          type: array
          items:
            type: integer
            format: int64
      required: [studentIds]

    LectureStudentAssignResponse:
      type: object
      properties:
        assignedCount:
          type: integer
          format: int32

    ########################
    # Assignments
    ########################
    AssignmentCreateRequest:
      type: object
      properties:
        lectureId:
          type: integer
          format: int64
        title:
          type: string
        description:
          type: string
        dueDate:
          type: string
          format: date-time
      required: [lectureId, title, dueDate]

    AssignmentCreateResponse:
      type: object
      properties:
        assignmentId:
          type: integer
          format: int64

    PresignedUrlRequest:
      type: object
      properties:
        fileName:
          type: string
        contentType:
          type: string
      required: [fileName]

    PresignedUrlResponse:
      type: object
      properties:
        url:
          type: string
        fileKey:
          type: string

    AssignmentSubmitRequest:
      type: object
      properties:
        fileKey:
          type: string
        comment:
          type: string

    AssignmentSubmitResponse:
      type: object
      properties:
        submissionId:
          type: integer
          format: int64
        submittedAt:
          type: string
          format: date-time

    ########################
    # Exams
    ########################
    ExamCreationRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
      required: [title, startTime, endTime]

    ExamCreationResponse:
      type: object
      properties:
        examId:
          type: integer
          format: int64

    QuestionRegistrationRequest:
      type: object
      properties:
        questionText:
          type: string
        choices:
          type: array
          items:
            type: string
        correctAnswerIndex:
          type: integer
          format: int32
        difficulty:
          type: string

    QuestionIdResponse:
      type: object
      properties:
        questionId:
          type: integer
          format: int64

    ExamDetailResponse:
      type: object
      properties:
        examId:
          type: integer
          format: int64
        title:
          type: string
        description:
          type: string

    ########################
    # Student Dashboard
    ########################
    MyLectureResponse:
      type: object
      properties:
        lectureId:
          type: integer
          format: int64
        title:
          type: string

    AttendanceCheckInResponse:
      type: object
      properties:
        attendanceId:
          type: integer
          format: int64
        status:
          type: string

    AssignmentSummaryResponse:
      type: object
      properties:
        assignmentId:
          type: integer
          format: int64
        title:
          type: string
        dueDate:
          type: string
          format: date-time

    ExamSummaryResponse:
      type: object
      properties:
        examId:
          type: integer
          format: int64
        title:
          type: string
        startTime:
          type: string
          format: date-time